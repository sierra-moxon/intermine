var WHOLE_LIST;var SHORT_LIST;var LONG_LIST;var PREFIX;var CUT_LIST;var INDEX;var IE;var MOUSE_OVER;var FIELD;var CLASS_NAME;var INPUT;var DISPLAY;var ERROR;var FRAME;setWholeList(false);setPrefix("");SHORT_LIST=new Array();LONG_LIST=new Array();CUT_LIST=new Array();setIndex(-1);IE=false;MOUSE_OVER=0;function setMouseOver(mouseOver){MOUSE_OVER=mouseOver;}function setWholeList(wholeList){WHOLE_LIST=wholeList;}function getWholeList(){return WHOLE_LIST;}function setCutList(cutList){CUT_LIST=cutList;}function setShortList(list){SHORT_LIST=list;}function setLongList(longList){LONG_LIST=longList;}function setPrefix(prefix){PREFIX=prefix;}function setIndex(index){INDEX=index;}function getId(input){INPUT=input;DISPLAY=input+"_display";ERROR=input+"_error";FRAME=input+"_IEbugFixFrame";}function loadList(){(function(){var suffix=document.getElementById(INPUT).value;var wholeList=getWholeList();var field=FIELD;var className=CLASS_NAME;AjaxServices.getContent(suffix,wholeList,field,className,function(array){jQuery("#"+INPUT).focus();if(array[0]=="true"){if(getWholeList()){setCutList(getElementList(array));setLongList(CUT_LIST);}else{setShortList(getElementList(array));}setPrefix(document.getElementById(INPUT).value);printList(getElementList(array));}else{if(array[0]!=""){printError(array[0]);}}});})();}function printError(error){removeList();$(ERROR).style.visibility="visible";getCoordinates($(ERROR),$(INPUT));$(ERROR).appendChild(document.createTextNode(error));}function getElementList(array){var elemList=new Array(array.length-1);for(var i=0;i<elemList.length;i++){elemList[i]=array[i+1];}return elemList;}function readInput(e,className,field){CLASS_NAME=className;FIELD=field;var curKey;if(e.which){curKey=e.which;IE=false;}else{if(e.keyCode){curKey=e.keyCode;IE=true;}}if($(INPUT).value.match("\\*")){removeList();return;}if((curKey>=65&&curKey<=90)||(curKey>=48&&curKey<=57)||(curKey>=96&&curKey<=105)||curKey==8||curKey==46){setIndex(-1);if(WHOLE_LIST&&$(INPUT).value.indexOf(PREFIX)!=0){setWholeList(false);loadList();}else{if(WHOLE_LIST){cutLongList();printList(CUT_LIST);}else{if(!WHOLE_LIST){loadList();}}}}else{if(curKey==38){var len;if(WHOLE_LIST){len=CUT_LIST.length-1;}else{len=SHORT_LIST.length-1;}remarkIndex();if(INDEX>-1){setIndex(INDEX-1);}else{setIndex(len);}scrollUp(len);markIndex();}else{if(curKey==40){var len;if(WHOLE_LIST){len=CUT_LIST.length-1;}else{len=SHORT_LIST.length-1;}remarkIndex();if(INDEX<len){setIndex(INDEX+1);}else{setIndex(-1);}scrollDown(len);markIndex();}else{setIndex(-1);}}}}function isSubmit(e){if((e.which==13&&INDEX>-1)||(e.keyCode==13&&INDEX>-1)){Event.stop(e);if(WHOLE_LIST){$(INPUT).value=CUT_LIST[INDEX];}else{$(INPUT).value=SHORT_LIST[INDEX];}removeList();$("attribute").click();}}function isEnter(e){var curKey;if(e.which){curKey=e.which;}else{if(e.keyCode){curKey=e.keyCode;}}if(curKey==13){Event.stop(e);if(INDEX>-1){if(WHOLE_LIST){$(INPUT).value=CUT_LIST[INDEX];}else{$(INPUT).value=SHORT_LIST[INDEX];}}removeList();}if(curKey==9){removeList();}}function markIndex(){if(INDEX!=-1){jQuery("#li"+INDEX.toString()).css("background","#8AECFF");}}function remarkIndex(){if(INDEX!=-1){jQuery("#li"+INDEX.toString()).css("background","none");}}function printList(array){removeList();if($(INPUT).value!=""&&array.length>0){getCoordinates($(DISPLAY),$(INPUT));if(IE){getCoordinates($(FRAME),$(INPUT));$(FRAME).height="150";}var ul=document.createElement("ul");ul.setAttribute("id","ulList");var li;for(var i=0;i<array.length;i++){li=document.createElement("li");li.setAttribute("val",array[i].toString());li.setAttribute("id","li"+i.toString());if(IE){li.setAttribute("onmousedown",function(){$(INPUT).value=this.getAttribute("val");removeList();});li.setAttribute("onmouseover",function(){remarkIndex();setIndex(parseInt(this.getAttribute("id").replace("li","")));markIndex();});li.setAttribute("onmouseout",function(){remarkIndex();setIndex(-1);});}else{li.setAttribute("onMouseDown","$(INPUT).value = this.getAttribute('val'); removeList();");li.setAttribute("onMouseOver","remarkIndex(); setIndex("+i+"); markIndex();");li.setAttribute("onMouseOut","remarkIndex(); setIndex(-1);");}$(DISPLAY).style.visibility="visible";li.appendChild(document.createTextNode(array[i]));ul.appendChild(li);}if(!WHOLE_LIST&&array.length==31&&$(INPUT).value.length>3){var input=document.createElement("input");input.setAttribute("type","button");if(IE){input.setAttribute("onmousedown",function(){setWholeList(true);loadList();});input.setAttribute("onmouseout",function(){this.style.background="#b2cdbf";});input.setAttribute("onmouseover",function(){this.style.background="#8AECFF";});input.style.background="#b2cdbf";input.style.color="#4c4d6b";input.style.border="none";input.style.width="100%";}else{input.setAttribute("class","more_results");input.setAttribute("onMouseDown","setWholeList(true); loadList();");input.setAttribute("onMouseOver","this.style.background = '#8AECFF';");input.setAttribute("onMouseOut","this.style.background = '#b2cdbf';");}input.setAttribute("value","MORE RESULTS...");input.setAttribute("TABINDEX","0");ul.appendChild(input);}$(DISPLAY).appendChild(ul);}else{$(FRAME).height="0";}}function removeList(){setIndex(-1);for(var i=0;i<2;i++){if($(DISPLAY).hasChildNodes()){$(DISPLAY).removeChild($(DISPLAY).firstChild);}}if($(ERROR).hasChildNodes()){$(ERROR).removeChild($(ERROR).firstChild);}if(IE){$(FRAME).height="0";$(DISPLAY).style.visibility="hidden";$(ERROR).style.visibility="hidden";}}function getCoordinates(target,source){target.clonePosition(source,{setHeight:false,offsetTop:source.offsetHeight});}function cutLongList(){var tmp=new Array();var wordList=new Array();var input=$(INPUT).value;tmp=input.split(" ");for(var i=0;i<tmp.length;i++){if(tmp[i].length>0){wordList.push(tmp[i]);}}CUT_LIST=new Array();for(var i=0;i<LONG_LIST.length;i++){var isContent=true;for(var j=0;j<wordList.length;j++){if(LONG_LIST[i].toLowerCase().indexOf(wordList[j].toLowerCase())==-1){isContent=false;}}if(isContent){CUT_LIST.push(LONG_LIST[i]);}}}function scrollDown(max){if($(DISPLAY).hasChildNodes()){if(INDEX<=2){$("ulList").scrollTop=0;}else{if(INDEX>2&&INDEX<(max-2)){var now=0;var after=$("li"+(INDEX+2).toString()).offsetHeight;for(var i=1;i<=(INDEX+1);i++){now+=$("li"+i.toString()).offsetHeight;}after+=now;if((now%150)>(after%150)){$("ulList").scrollTop=now-$("li"+(INDEX+1).toString()).offsetHeight;}}else{if(INDEX>=(max-2)){var jumpDown=0;for(var i=1;i<max;i++){jumpDown+=$("li"+i.toString()).offsetHeight;}$("ulList").scrollTop=jumpDown;}}}}}function scrollUp(max){if($(DISPLAY).hasChildNodes()){if(INDEX==max){var jumpDown=0;for(var i=1;i<max;i++){jumpDown+=$("li"+i.toString()).offsetHeight;}$("ulList").scrollTop=jumpDown;}else{if(INDEX>-1){var now=0;var after=$("li"+INDEX.toString()).offsetHeight;for(var i=max;i>INDEX;i--){now+=$("li"+i.toString()).offsetHeight;}after+=now;if((now%150)>(after%150)){var jumpUp=1;var before=0;var i=INDEX;while(i>0&&((before%150)<(jumpUp%150))){before+=$("li"+i.toString()).offsetHeight;i--;jumpUp=before+$("li"+i.toString()).offsetHeight;}var top=0;for(var i=1;i<=(INDEX+1);i++){top+=$("li"+i.toString()).offsetHeight;}$("ulList").scrollTop=top-jumpUp;}}}}}