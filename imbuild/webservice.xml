
<project name="webservice" default="default" basedir="."
         xmlns:websrv="http://www.intermine.org/ns/im-webservice-proj/1"
         xmlns:task="http://www.intermine.org/ns/im-task-proj/1">

  <dirname property="webservice.xml.basedir" file="${ant.file.webservice}"/>
  <import file="${webservice.xml.basedir}/webapp.xml"/>
  <import file="${webservice.xml.basedir}/task.xml"/>

  <!-- Local webservice build/deploy properties -->
<!-- not needed, this file has been merged with *mine.properties
  <property name="build.properties.local" value="${user.home}/.intermine/${ant.project.name}.properties" />
  <property file="${build.properties.local}"/>
-->

  <!-- INIT -->

  <target name="-pre-init" depends="webapp.-pre-init">
    <!-- Files -->
    <!-- Location of model-less intermine-webservice.war -->
    <property name="source.intermine.webservice.war" location="${webservice.xml.basedir}/../intermine/webservice/server/dist/intermine-webservice.war"/>
  </target>

  <!-- WAR INSTEAD OF JAR -->

  <target name="-pre-jar" depends="-init-properties, webapp.-pre-jar">
    <!-- Start with base intermine webservice war -->
    <copy file="${source.intermine.webservice.war}" tofile="${dist.war}"/>
    <!-- Copy intermine.properties into build/classes -->
    <copy file="${user.home}/.intermine/${intermine.properties.file}"
          tofile="${build.classes.dir}/intermine.properties"/>
    <!-- Copy default.intermine.properties into build/classes -->
    <copy file="${default.intermine.properties.file}"
          tofile="${build.classes.dir}/default.intermine.properties"/>
  </target>

  <target name="do-jar" depends="-init-presetdef-war">
    <websrv:war/>
  </target>

  
  <!-- MACRO DEFINITIONS -->

  <target name="-init-presetdef-war">
    <macrodef name="war" uri="http://www.intermine.org/ns/im-webservice-proj/1">
      <sequential>
        <war compress="${jar.compress}" destfile="${dist.war}" update="true">
          <classes dir="${build.classes.dir}"/>
          <!--webinf dir="${webinf.dir}" excludes="web.xml"/>
          <webinf dir="${build.webinf.dir}"/>
          <fileset dir="${resources.dir}"/-->
        </war>
      </sequential>
    </macrodef>
  </target>

</project>
