<%@ taglib uri="http://java.sun.com/jsp/jstl/core" prefix="c"%>
<%@ taglib uri="http://java.sun.com/jsp/jstl/fmt" prefix="fmt"%>
<%@ taglib uri="/WEB-INF/struts-html.tld" prefix="html"%>
<%@ taglib uri="/WEB-INF/struts-tiles.tld" prefix="tiles"%>
<%@ taglib uri="http://java.sun.com/jsp/jstl/functions" prefix="fn"%>
<%@ taglib tagdir="/WEB-INF/tags" prefix="im"%>
<%@ taglib uri="http://flymine.org/imutil" prefix="imutil"%>
<%@ taglib uri="http://jakarta.apache.org/taglibs/string-1.1"
  prefix="str"%>

<tiles:importAttribute />

<html:xhtml />

<style type="text/css">
div#submissionLabName h3, div#submissionLabName div#submissionProject {
  color: black;
  margin-bottom: 20px;
}
div#submissionOrganism {
  color: black;
  margin-bottom: 20px;
}
div#submissionResults {
  color: black;
  margin-bottom: 20px;
  border: 1px;
  border-style: solid;
  border-color: green;
  font-size: 1.2em;
  background-color: #DFA;
  padding: 5px;
  width: 500px;
}


</style>

<div class="body">
  <div id="submissionLabName">
    <h3>
      <b>Lab:</b> <html:link href="/${WEB_PROPERTIES['webapp.path']}/objectDetails.do?id=${object.lab.id}">${object.lab.name}</html:link>
      - ${object.lab.affiliation}
    </h3>
  </div>
  <div id="submissionProject">
      <b>Project:</b> <html:link href="/${WEB_PROPERTIES['webapp.path']}/objectDetails.do?id=${object.lab.project.id}">${object.lab.project.name}</html:link>
  </div>
  <div id="submissionOrganism">
      <b>Organism:</b> <html:link href="/${WEB_PROPERTIES['webapp.path']}/objectDetails.do?id=${object.organism.id}">${object.organism.shortName}</html:link>
  </div>
  <div id="submissionResults">
    <p><b>Get features generated by this submission:</b></p>
    <br/>
    <p>
        <table cellpadding="0" cellspacing="0" border="0" class="results">
      <tr>
        <th>Feature type</th>
        <th>Count</th>
        <th>View data</th>
        <th colspan="3">Export</th>
      </tr>
      <c:forEach items="${featureCounts}" var="fc" varStatus="status">
        <c:if test='${fc.key != "Chromosome"}'>
          <tr>
            <td>${fc.key}</td>
            <td>${fc.value}</td>                     
            <td align="right">
              <c:choose>
                <c:when test='${fc.key eq "EST" || fc.key eq "MNRA"}'>
                  <im:querylink text="RESULTS TABLE" skipBuilder="true">
                    <query name="" model="genomic"
                           view="${fc.key}.primaryIdentifier ${fc.key}.secondaryIdentifier ${fc.key}.length
                                 ${fc.key}.chromosomeLocation.object.primaryIdentifier ${fc.key}.chromosomeLocation.start ${fc.key}.chromosomeLocation.end ${fc.key}.dataSets.title"
                           sortOrder="${fc.key}.primaryIdentifier asc">
                      <node path="${fc.key}" type="${fc.key}">
                      </node>
                      <node path="${fc.key}.dataSets" type="DataSet">
                      </node>
                      <node path="${fc.key}.dataSets.title" type="String">
                        <constraint op="=" value="${object.title}" description=""
                                    identifier="" code="A">
                        </constraint>
                      </node>
                    </query>
                  </im:querylink>
                </c:when>

                <c:otherwise>
                  <im:querylink text="RESULTS TABLE" skipBuilder="true">
                    <query name="" model="genomic"
                           view="${fc.key}.secondaryIdentifier ${fc.key}.length
                                 ${fc.key}.chromosomeLocation.object.primaryIdentifier ${fc.key}.chromosomeLocation.start ${fc.key}.chromosomeLocation.end ${fc.key}.dataSets.title"
                           sortOrder="${fc.key}.secondaryIdentifier asc">
                      <node path="${fc.key}" type="${fc.key}">
                      </node>
                      <node path="${fc.key}.dataSets" type="DataSet">
                      </node>
                      <node path="${fc.key}.dataSets.title" type="String">
                        <constraint op="=" value="${object.title}" description=""
                                    identifier="" code="A">
                        </constraint>
                      </node>
                    </query>
                  </im:querylink>
                </c:otherwise>
              </c:choose>
            </td>
            <td align="right">
              <c:choose>
                <c:when test='${fc.key eq "EST" || fc.key eq "MNRA"}'>
                  <im:querylink text="TAB DELIMITED" skipBuilder="true" exportFormat="tab">
                    <query name="" model="genomic"
                           view="${fc.key}.primaryIdentifier ${fc.key}.secondaryIdentifier ${fc.key}.length
                                 ${fc.key}.chromosomeLocation.object.primaryIdentifier ${fc.key}.chromosomeLocation.start ${fc.key}.chromosomeLocation.end ${fc.key}.dataSets.title"
                           sortOrder="${fc.key}.primaryIdentifier asc">
                      <node path="${fc.key}" type="${fc.key}">
                      </node>
                      <node path="${fc.key}.dataSets" type="DataSet">
                      </node>
                      <node path="${fc.key}.dataSets.title" type="String">
                        <constraint op="=" value="${object.title}" description=""
                                    identifier="" code="A">
                        </constraint>
                      </node>
                    </query>
                  </im:querylink>
                </c:when>

                <c:otherwise>
                  <im:querylink text="TAB DELIMITED" skipBuilder="true" exportFormat="tab">
                    <query name="" model="genomic"
                           view="${fc.key}.secondaryIdentifier ${fc.key}.length
                                 ${fc.key}.chromosomeLocation.object.primaryIdentifier ${fc.key}.chromosomeLocation.start ${fc.key}.chromosomeLocation.end ${fc.key}.dataSets.title"
                           sortOrder="${fc.key}.secondaryIdentifier asc">
                      <node path="${fc.key}" type="${fc.key}">
                      </node>
                      <node path="${fc.key}.dataSets" type="DataSet">
                      </node>
                      <node path="${fc.key}.dataSets.title" type="String">
                        <constraint op="=" value="${object.title}" description=""
                                    identifier="" code="A">
                        </constraint>
                      </node>
                    </query>
                  </im:querylink>
                </c:otherwise>
              </c:choose>
            </td>
            <td align="right">
              <c:choose>
                <c:when test='${fc.key eq "EST" || fc.key eq "MNRA"}'>
                  <im:querylink text="GFF3" skipBuilder="true" exportFormat="gff3">
                    <query name="" model="genomic"
                           view="${fc.key}.primaryIdentifier ${fc.key}.secondaryIdentifier ${fc.key}.length
                                 ${fc.key}.chromosomeLocation.object.primaryIdentifier ${fc.key}.chromosomeLocation.start ${fc.key}.chromosomeLocation.end ${fc.key}.dataSets.title"
                           sortOrder="${fc.key}.primaryIdentifier asc">
                      <node path="${fc.key}" type="${fc.key}">
                      </node>
                      <node path="${fc.key}.dataSets" type="DataSet">
                      </node>
                      <node path="${fc.key}.dataSets.title" type="String">
                        <constraint op="=" value="${object.title}" description=""
                                    identifier="" code="A">
                        </constraint>
                      </node>
                    </query>
                  </im:querylink>
                </c:when>

                <c:otherwise>
                  <im:querylink text="GFF3" skipBuilder="true" exportFormat="gff3">
                    <query name="" model="genomic"
                           view="${fc.key}.secondaryIdentifier ${fc.key}.length
                                 ${fc.key}.chromosomeLocation.object.primaryIdentifier ${fc.key}.chromosomeLocation.start ${fc.key}.chromosomeLocation.end ${fc.key}.dataSets.title"
                           sortOrder="${fc.key}.secondaryIdentifier asc">
                      <node path="${fc.key}" type="${fc.key}">
                      </node>
                      <node path="${fc.key}.dataSets" type="DataSet">
                      </node>
                      <node path="${fc.key}.dataSets.title" type="String">
                        <constraint op="=" value="${object.title}" description=""
                                    identifier="" code="A">
                        </constraint>
                      </node>
                    </query>
                  </im:querylink>
                </c:otherwise>
              </c:choose>
            </td>
            <td align="right">
              <c:choose>
                <c:when test='${fc.key eq "EST" || fc.key eq "MNRA"}'>
                  <im:querylink text="SEQUENCE" skipBuilder="true" exportFormat="sequence">
                    <query name="" model="genomic"
                           view="${fc.key}.primaryIdentifier ${fc.key}.secondaryIdentifier ${fc.key}.length
                                 ${fc.key}.chromosomeLocation.object.primaryIdentifier ${fc.key}.chromosomeLocation.start ${fc.key}.chromosomeLocation.end ${fc.key}.dataSets.title"
                           sortOrder="${fc.key}.primaryIdentifier asc">
                      <node path="${fc.key}" type="${fc.key}">
                      </node>
                      <node path="${fc.key}.dataSets" type="DataSet">
                      </node>
                      <node path="${fc.key}.dataSets.title" type="String">
                        <constraint op="=" value="${object.title}" description=""
                                    identifier="" code="A">
                        </constraint>
                      </node>
                    </query>
                  </im:querylink>
                </c:when>

                <c:otherwise>
                  <im:querylink text="SEQUENCE" skipBuilder="true" exportFormat="sequence">
                    <query name="" model="genomic"
                           view="${fc.key}.secondaryIdentifier ${fc.key}.length
                                 ${fc.key}.chromosomeLocation.object.primaryIdentifier ${fc.key}.chromosomeLocation.start ${fc.key}.chromosomeLocation.end ${fc.key}.dataSets.title"
                           sortOrder="${fc.key}.secondaryIdentifier asc">
                      <node path="${fc.key}" type="${fc.key}">
                      </node>
                      <node path="${fc.key}.dataSets" type="DataSet">
                      </node>
                      <node path="${fc.key}.dataSets.title" type="String">
                        <constraint op="=" value="${object.title}" description=""
                                    identifier="" code="A">
                        </constraint>
                      </node>
                    </query>
                  </im:querylink>
                </c:otherwise>
              </c:choose>
            </td>
          </tr>
        </c:if>
      </c:forEach>
      <!-- end submission loop -->
    </table>
    <br/>
    </div>
  </div>
</div>
